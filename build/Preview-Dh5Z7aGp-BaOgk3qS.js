import{cb as G,j as e,cc as Q,cd as Y,aP as H,n as Z,P as x,B as j,cf as X,aY as _,u as b,r as R,a9 as L,cj as J,cl as K,eo as ee,cg as te,ch as se,a1 as ne,F as w,I as B,ep as E,bL as ae,i as D,b4 as W,dt as O,eq as re,er as ie,es as M,d as I,cm as oe,S as k,et as T,aZ as ce,ax as de,bd as le,T as ue,ct as pe,bZ as A}from"./strapi-6fXDAyIt.js";import{F as me}from"./Input-CtIJ2J0c-CsH_9Zmv.js";import{getDocumentStatus as U}from"./EditViewPage-BpGtaOKG-B5pGyBjj.js";import"./Relations-DP5krCGC-CjhKyGE6.js";import"./relations-Dv0FHoBS-C5GNrEd_.js";import"./usePrev-Bjw2dhmq-BRJONMiV.js";import"./useDragAndDrop-HYwNDExe-wM_q52ul.js";import"./objects-wl73iEma-CNscYJvs.js";import"./ComponentIcon-BZcTc4rj-D4qdNWvu.js";import"./getEmptyImage-CjqolaH3.js";const he=()=>{const t=u("PreviewContent",a=>a.url),{formatMessage:n}=b();return e.jsx(j,{src:t,title:n({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},t)},V=()=>{const[{query:t}]=L(),{formatMessage:n}=b(),a=T("BackButton",c=>c.canGoBack),o=T("BackButton",c=>c.goBack),l=T("BackButton",c=>c.history),r=T("BackButton",c=>c.currentLocationIndex),m=a?l.at(r-2):void 0,p={pathname:"..",search:ce.stringify(t,{encode:!1})},h=m??p,i=c=>{if(a){c.preventDefault(),o();return}};return e.jsx(B,{variant:"ghost",tag:de,relative:"path",to:h,onClick:i,label:n({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(le,{})})},q=()=>{const t=u("PreviewHeader",r=>r.document),n=u("PreviewHeader",r=>r.schema),a=u("PreviewHeader",r=>r.meta);if(!(n?.options?.draftAndPublish??!1))return null;const l=U(t,a);return e.jsx(pe,{status:l,size:"XS"})},$=()=>{const{formatMessage:t}=b(),[{query:n},a]=L(),o=u("PreviewHeader",i=>i.document),l=u("PreviewHeader",i=>i.schema),r=u("PreviewHeader",i=>i.meta),m=l?.options?.draftAndPublish??!1,p=U(o,r),h=i=>{(i==="published"||i==="draft")&&a({status:i},"push",!0)};return m?e.jsx(A.Root,{variant:"simple",value:n.status||"draft",onValueChange:h,children:e.jsxs(A.List,{"aria-label":t({id:"preview.tabs.label",defaultMessage:"Document status"}),children:[e.jsx(F,{value:"draft",children:t({id:"content-manager.containers.List.draft",defaultMessage:"draft"})}),e.jsx(F,{value:"published",disabled:p==="draft",children:t({id:"content-manager.containers.List.published",defaultMessage:"published"})})]})}):null},ge=()=>{const t=u("PreviewHeader",d=>d.title),n=u("PreviewHeader",d=>d.document),a=u("PreviewHeader",d=>d.schema),o=u("PreviewHeader",d=>d.meta),l=ae("PreviewHeader",d=>d.plugins),r=u("PreviewHeader",d=>d.iframeRef),[{query:m}]=L(),{formatMessage:p}=b(),{toggleNotification:h}=D(),{copy:i}=W(),c=()=>{i(window.location.href),h({message:p({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})},s=a.options?.draftAndPublish??!1,f={activeTab:m.status??null,collectionType:a.kind==="collectionType"?"collection-types":"single-types",model:a.uid,documentId:n.documentId,document:n,meta:o,onPreview:()=>{r?.current?.contentWindow?.postMessage({type:"strapiUpdate"})}};return e.jsxs(w,{height:"48px",gap:4,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(xe,{height:"100%",paddingLeft:2,paddingRight:4,children:[e.jsx(V,{}),e.jsx(z,{tag:"h1",title:t,maxWidth:"200px",fontSize:2,paddingLeft:2,paddingRight:3,fontWeight:600,children:t}),e.jsx(q,{})]}),e.jsxs(w,{flex:1,paddingRight:2,gap:2,justifyContent:s?"space-between":"flex-end",children:[e.jsx(w,{flex:"1 1 70%",children:e.jsx($,{})}),e.jsxs(w,{gap:2,children:[e.jsx(B,{type:"button",label:p({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:c,children:e.jsx(O,{})}),e.jsx(re,{area:"preview.actions"}),e.jsx(ie,{props:f,descriptions:l["content-manager"].apis.getDocumentActions("preview"),children:d=>{const C=d.filter(y=>[y.position].flat().includes("preview")),[g,v]=C;return!g&&!v?null:g&&v?e.jsxs(e.Fragment,{children:[e.jsx(M,{...v,variant:v.variant||"secondary"}),e.jsx(M,{...g,variant:g.variant||"default"})]}):e.jsx(M,{...g,variant:g.variant||"secondary"})}})]})]})]})},fe=()=>{const t=u("PreviewHeader",r=>r.title),{formatMessage:n}=b(),{toggleNotification:a}=D(),{copy:o}=W(),l=()=>{o(window.location.href),a({message:n({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(k.Root,{gap:3,gridCols:3,paddingLeft:2,paddingRight:2,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(k.Item,{xs:1,paddingTop:2,paddingBottom:2,gap:3,children:[e.jsx(V,{}),e.jsx(z,{tag:"h1",fontWeight:600,fontSize:2,maxWidth:"200px",title:t,children:t}),e.jsx(q,{})]}),e.jsx(k.Item,{xs:1,marginBottom:"-1px",alignItems:"end",margin:"auto",children:e.jsx($,{})}),e.jsx(k.Item,{xs:1,justifyContent:"end",paddingTop:2,paddingBottom:2,children:e.jsx(B,{type:"button",label:n({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:l,children:e.jsx(O,{})})})]})},z=I(ue)`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,F=I(A.Trigger)`
  text-transform: uppercase;
`,xe=I(w)`
  border-right: 1px solid ${({theme:t})=>t.colors.neutral150};
`,[we,u]=G("PreviewPage"),ve=I(oe)`
  will-change: transform;
  rotate: ${t=>t.isSideEditorOpen?"0deg":"180deg"};
  transition: rotate 0.2s ease-in-out;
`,je=()=>{const t=_(),{formatMessage:n}=b(),a=R.useRef(null),[o,l]=R.useState(!0),{slug:r,id:m,collectionType:p}=H(),[{query:h}]=L(),i=R.useMemo(()=>J(h),[h]);if(!p)throw new Error("Could not find collectionType in url params");if(!r)throw new Error("Could not find model in url params");if(p===K&&!m)throw new Error("Could not find documentId in url params");const c=ee({params:{contentType:r},query:{documentId:m,locale:i.locale,status:i.status}}),s=te({model:r,collectionType:p,documentId:m,params:i}),f=se(r);if((c.isLoading||f.isLoading||s.isLoading)&&!s.document?.documentId)return e.jsx(x.Loading,{});const C=s.getInitialFormValues();if(c.error||f.error||!s.document||!s.meta||!s.schema||!C)return e.jsx(x.Error,{});if(!c.data?.data?.url)return e.jsx(x.NoData,{});const g=s.getTitle(f.edit.settings.mainField),v=(P,S)=>E(s.schema?.attributes,s.components,{status:s.document?.status,...S}).validateSync(P,{abortEarly:!1}),y=c.data.data.url;return e.jsxs(e.Fragment,{children:[e.jsx(x.Title,{children:n({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:g})}),e.jsx(we,{url:y,document:s.document,title:g,meta:s.meta,schema:s.schema,layout:f.edit,iframeRef:a,children:e.jsx(ne,{method:"PUT",disabled:h.status==="published"&&s&&s.document.status==="published",initialValues:s.getInitialFormValues(),initialErrors:t?.state?.forceValidation?v(C,{}):{},height:"100%",validate:(P,S)=>E(s.schema?.attributes,s.components,{status:s.document?.status,...S}).validate(P,{abortEarly:!1}),children:e.jsx(w,{direction:"column",height:"100%",alignItems:"stretch",children:window.strapi.future.isEnabled("unstablePreviewSideEditor")?e.jsxs(e.Fragment,{children:[e.jsx(ge,{}),e.jsxs(w,{flex:1,overflow:"auto",alignItems:"stretch",children:[e.jsx(j,{overflow:"auto",width:o?"50%":0,borderWidth:"0 1px 0 0",borderColor:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:o?6:0,paddingRight:o?6:0,transition:"all 0.2s ease-in-out",children:e.jsx(me,{layout:f.edit.layout,hasBackground:!0})}),e.jsxs(j,{position:"relative",flex:1,height:"100%",overflow:"hidden",children:[e.jsx(j,{"data-testid":"preview-iframe",ref:a,src:y,title:n({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},y),e.jsx(B,{variant:"tertiary",label:n(o?{id:"content-manager.preview.content.close-editor",defaultMessage:"Close editor"}:{id:"content-manager.preview.content.open-editor",defaultMessage:"Open editor"}),onClick:()=>l(P=>!P),position:"absolute",top:2,left:2,children:e.jsx(ve,{isSideEditorOpen:o})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{}),e.jsx(he,{})]})})})})]})},be=()=>{const{slug:t}=H(),{permissions:n=[],isLoading:a,error:o}=Z([{action:"plugin::content-manager.explorer.read",subject:t},{action:"plugin::content-manager.explorer.update",subject:t},{action:"plugin::content-manager.explorer.publish",subject:t}]);return a?e.jsx(x.Loading,{}):o||!t?e.jsx(j,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(x.Error,{})}):e.jsx(j,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(x.Protect,{permissions:n.filter(l=>l.action.includes("explorer.read")),children:e.jsx(X,{permissions:n,children:e.jsx(je,{})})})})},Me=()=>e.jsx(Q,{children:e.jsx(Y,{children:e.jsx(be,{})})});export{Me as ProtectedPreviewPage,u as usePreviewContext};
